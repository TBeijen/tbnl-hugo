---
title: 'Hackathon: Running NU.nl on LeafCloud sustainable hosting'
author: Tibo Beijen
date: 2023-02-01T10:00:00+01:00
url: /2023/02/01/hackathon-hosting-nunl-on-leafcloud
categories:
  - articles
tags:
  - NU.nl
  - AWS
  - Leafcloud
  - Sustainability
  - Kubernetes
description: "Hackathon time! The theme being 'climate': What would it take to run NU.nl on LeafCloud, a more environmental-friendly cloud than AWS? Let's find out."
thumbnail: img/todo.jpg

---
## Introduction

Once or twice a year, NU.nl organizes a hackathon, allowing its IT staff to dabble in new technology and pursue ideas, usually guided by a number of themes. 2023 kicked off with a hackathon having the themes 'NU2030', 'NU.nl from scratch' and 'A greener NU.nl'.

Mid 2022 I [visited EdgeCase](/2022/06/01/edgecase-2022), a 1-day conference about running Kubernetes at the edge. One of the presentations was by [LeafCloud](https://www.leaf.cloud/), a hosting provider focusing on reducing the environmental impact of cloud computing by re-using the heat that it generates. 

Back then I somewhat jokingly proposed to run our `/klimaat` section from LeafCloud. So, knowing we have most of our compute on Kubernetes, one of the compute platforms offered, and one of this Hackathon's themes being climate, there is no better moment to do a POC.

In this blogpost:


**Disclaimer:** This is a _personal_ blog. So while NU.nl (part of DPG Media) facilitated the hackathon and supports the theme, opinions and conclusions are mine. This post holds no commitment in any way from NU.nl or DPG Media.

## LeafCloud

LeafCloud uses the heat generated by servers to [substitute the use of fossil fuel for heating](https://www.leaf.cloud/truly-green). It does so by constructing LeafSites at the location where heat is needed, such as swimming pools or apartment buildings. In short:

> Don't bring cooling to the datacenter. Bring the datacenter to the cooling.

It's a creative and pragmatic approach to address the environmental impact which - it might be my background of Industrial Design engineering - resonates well with me.

Now there's various other ways to reduce environmental impact of running compute:

* Right-sizing and autoscaling
* Serverless
* More efficient CPU such as ARM

There is no 'or' here, all of them are worth pursuing. However, as below image shows, none of them might be as effective as using hosting that's designed from the ground up to be environmental-friendly.

{{< figure src="/img/hackathon_leafcloud_ere.svg" title="Energy Reuse Effectiveness (ERE). Source: LeafCloud" >}}

## POC outline

Below image shows a simplified outline of NU.nl architecture. Website and mobile apps consume a Backend For Frontend (BFF), which in turn uses various other APIs (mostly REST) APIs. All is frontend by Akamai to keep the bad guys away.

Data and private network APIs constitute gravity, moving away from it tends to be hard. Compute consuming public APIs is easy, it can run anywhere. 

Scope of POC is deploying frontend and optionally BFF for non-prod environment to LeafCloud. Getting the workloads to run somewhere else is not expected to be the hard part. The goal is to explore what it would take to go beyond a POC and identify blocking topics or topics that need further investigation. 

{{< figure src="/img/hackathon_leafcloud_plan.gif" title="Plan: Run part of stack in LeafCloud" >}}

## Required abilities

The abilities required to effectively run a set of Kubernetes applications outside of AWS can be categorized as follows:

* Easily set up clusters
* Easily deploy a number of applications
* Integrate with AWS and other services

## Easily set up clusters

As Kubernetes matures one could observe that various improvements have made it easier than ever to consider clusters as ephemeral resources. Clouds offer managed Kubernetes, more lightweight alternatives as K3S and [RKE2](https://docs.rke2.io/) emerged. And then there is ClusterAPI: The ability to setup a cluster as management cluster and deploy remote clusters in a similar way as deploying pods.

LeafCloud is based on OpenStack which itself also offers a managed Kubernetes cluster. Exploring some of the opions to get started resulted in the following:

|Technology        | Supports autoscaler | Getting started |
|------------------|---------------------|-----------------|
|OpenStack cluster | Yes                 | Average         |
|RKE2              | No                  | Easy            |
|ClusterAPI        | Yes                 | Hard            |

RKE2 is quite easily set up using the [remche/terraform-openstack-rke2](https://github.com/remche/terraform-openstack-rke2) Terraform module, which also sets up network components. LeafCloud was so nice to provide some example IaC based on this module that adds properly configured storage driver and cloud-controller-manager (used by K8S control plane to add loadbalancer).

So, since time was limited and we also wanted to explore other topics we opted to hit the ground running and started with RKE2. 

When exploring further it would be worth trying out OpenStack as well as ClusterAPI. To see what's possible using ClusterAPI it's worth reading [this blog post by Helio](https://blog.helio.exchange/posts/deploying-kubernetes-with-cluster-api).

## Easily deploy a number of applications

